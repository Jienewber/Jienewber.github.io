<!DOCTYPE html>
<html>
<head>
	<title>Advanced CartoDB</title>
	<link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/leaflet.draw.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
	<!-- Set up divs -->
	<div id="wrapper">
		<div id="header">
			<h1>Leaflet Data Collection Tool</h1>
		</div>
		<div id="map"></div>
		<div id="controls">
			<div id="hints">
				<p>Click points for more information, or add your own.</p>
			</div>
			<button id="startEdit">Click to Start Editing</button>
			<button id="stopEdit">Stop Your Editing Session</button>
		</div>
		<div id="credits">
			<p>#DUSPviz Web Map Workshop - Jie Liu, 2017</p>
		</div>
	</div>

	<!-- Reference to Leaflet and jQuery javascript libraries -->
	<script src="js/leaflet.js"></script>
    <script src="js/leaflet.draw.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    
    <script>
		// Create basemap
		var map = L.map('map',{center:[42.381899, -71.122499], zoom: 13});
		L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/light-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibmV3YmVyODQiLCJhIjoiY2ozanJsdzc3MDBmZzMycXN5a3YwdDI4cyJ9.2Bsck9PsZA2uEuuqqayH3g', {
	      attribution: '©Mapbox ©OpenStreetMap',
	      minZoom: 2,
	      maxZoom: 18
	    }).addTo(map);

	    // Load data from CartoDB
	   


	    // Add Data from CARTO using the SQL API
		// Declare Variables
		// Create Global Variable to hold CARTO points

		

		// Add Data from CARTO using the SQL API
		// Declare Variables
		// Create bike icon (Notes: use ","" as separators of attributes of the icon)
		var bikeIcon = new L.Icon({
            iconUrl:'images/bicycle-15.svg',
    		iconSize:[25, 25]
        });
		// Create Global Variable to hold CARTO points
		var cartoDBPoints = null;

		// Set your CARTO Username
		var cartoDBusername = "jienewber";

		// Write SQL Selection Query to be Used on CARTO Table
		// Name of table is 'data_collector'
		var sqlQuery = "SELECT * FROM data_collector";

		// Get CARTO selection as GeoJSON and Add to Map
		function getGeoJSON() {
			$.getJSON("https://"+cartoDBusername+".cartodb.com/api/v2/sql?format=GeoJSON&q="+sqlQuery, function(data) {
				cartoDBPoints = L.geoJson(data, {
					pointToLayer: function(feature, latlng) {
						var marker = L.marker(latlng, {icon: bikeIcon});
						marker.bindPopup('<h2>' + feature.properties.description + '</h2><p>Submitted by ' + feature.properties.name + '</p>');
						return marker;
					}
				}).addTo(map);
			});
		};
		
		// Run showAll function automatically when document loads
		$( document ).ready(function() {
		  getGeoJSON();
		});





	</script>
</body>
</html>
